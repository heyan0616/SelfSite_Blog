{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{227:function(s,a,t){s.exports=t.p+\"assets/img/https-1.921692e6.jpg\"},228:function(s,a,t){s.exports=t.p+\"assets/img/https-2.7c821ae1.jpg\"},229:function(s,a,t){s.exports=t.p+\"assets/img/https-3.de92e16a.jpg\"},230:function(s,a,t){s.exports=t.p+\"assets/img/https-4.525b51ec.jpg\"},231:function(s,a,t){s.exports=t.p+\"assets/img/https-5.a8c8740b.jpg\"},300:function(s,a,t){\"use strict\";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"网站https升级\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#网站https升级\"}},[s._v(\"#\")]),s._v(\" 网站https升级\")]),s._v(\" \"),n(\"p\",[s._v(\"之前，网站是http访问的，鉴于目前主流安全的需求，基本所有网站都已经使用https，那也来尝试下吧。本文介绍如何从阿里云申请证书，然后如何升级服务器配置。\")]),s._v(\" \"),n(\"h2\",{attrs:{id:\"阿里云申请ssl证书\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#阿里云申请ssl证书\"}},[s._v(\"#\")]),s._v(\" 阿里云申请SSL证书\")]),s._v(\" \"),n(\"p\",[s._v(\"进入阿里云控制台，搜索“证书服务”，选择SSL证书，进入界面：\")]),s._v(\" \"),n(\"div\",{staticStyle:{display:\"flex\"}},[n(\"img\",{staticStyle:{zoom:\"40%\",display:\"block\"},attrs:{src:t(227),alt:\"\",align:\"left\"}})]),s._v(\" \"),n(\"p\",[s._v(\"点“选购证书”\")]),s._v(\" \"),n(\"div\",{staticStyle:{display:\"flex\"}},[n(\"img\",{staticStyle:{zoom:\"30%\",display:\"block\"},attrs:{src:t(228),alt:\"\",align:\"left\"}})]),s._v(\" \"),n(\"p\",[s._v(\"选择个人免费版后，然后立即购买。\")]),s._v(\" \"),n(\"p\",[s._v(\"购买后进入证书控制台界面， >然后根据提示补全个人信息后，>最后提交申请。\")]),s._v(\" \"),n(\"p\",[s._v(\"几分钟后，证书显示“已签发”\")]),s._v(\" \"),n(\"div\",{staticStyle:{display:\"flex\"}},[n(\"img\",{staticStyle:{zoom:\"40%\",display:\"block\"},attrs:{src:t(229),alt:\"\",align:\"left\"}})]),s._v(\" \"),n(\"p\",[s._v(\"最后点击下载，选择Nginx\")]),s._v(\" \"),n(\"div\",{staticStyle:{display:\"flex\"}},[n(\"img\",{staticStyle:{zoom:\"40%\",display:\"block\"},attrs:{src:t(230),alt:\"\",align:\"left\"}})]),s._v(\" \"),n(\"p\",[s._v(\"下载解压后，会看到两个文件 （一个.key文件，一个.pem文件）\")]),s._v(\" \"),n(\"h2\",{attrs:{id:\"网站升级\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#网站升级\"}},[s._v(\"#\")]),s._v(\" 网站升级\")]),s._v(\" \"),n(\"p\",[s._v(\"目前由于我们单独部署了主页homepage和博客，所以需要都升级一下。\")]),s._v(\" \"),n(\"h3\",{attrs:{id:\"homepage升级\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#homepage升级\"}},[s._v(\"#\")]),s._v(\" Homepage升级\")]),s._v(\" \"),n(\"ol\",[n(\"li\",[n(\"p\",[s._v(\"在/conf.d文件夹下创建cert文件夹，然后将证书文件copy进去（当然也可以在最外层新建/cert文件夹。。此处图方便，用已有的文件夹存放）\")]),s._v(\" \"),n(\"div\",{staticStyle:{display:\"flex\"}},[n(\"img\",{staticStyle:{zoom:\"40%\",display:\"block\"},attrs:{src:t(231),alt:\"\",align:\"left\"}})])]),s._v(\" \"),n(\"li\",[n(\"p\",[s._v(\"修改default.conf配置文件\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[n(\"code\",[s._v(\"server \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    listen       443 ssl;\\n    server_name  heyan.site;\\n    ssl_certificate  /etc/nginx/conf.d/cert/xxxxxx_heyan.site.pem;\\n    ssl_certificate_key /etc/nginx/conf.d/cert/xxxxxx_heyan.site.key;\\n    ssl_session_timeout 5m;\\n    ssl_ciphers ECDHE\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"RSA\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"AES128\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"GCM\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"SHA256\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"ECDHE\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"ECDH\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"AES\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"HIGH\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s._v(\"!NULL:!aNULL:!MD5:!ADH:!RC4;\")]),s._v(\"\\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\\n    ssl_prefer_server_ciphers on;\\n\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#charset koi8-r;\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#access_log  /var/log/nginx/host.access.log  main;\")]),s._v(\"\\n\\n    location / \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        root    /usr/share/nginx/html;\\n        index   index.html index.htm;\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n    error_page   500 502 503 504  /50x.html;\\n    location = /50x.html \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        root   /usr/share/nginx/html;\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\nserver \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    listen 80;\\n    server_name heyan.site;\\n    rewrite ^(.*)$ https\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"//$host$1 permanent;\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),n(\"br\")])]),n(\"blockquote\",[n(\"p\",[s._v(\"这里最后的配置是通过rewrite方式把所有http请求也转成了https请求，更加安全，这样所有的http请求就会自动转成https\")])])]),s._v(\" \"),n(\"li\",[n(\"p\",[s._v(\"上传default.conf文件到云服务器\")])]),s._v(\" \"),n(\"li\",[n(\"p\",[s._v(\"停止并删除原来的容器（需要重建容器来映射新的ssl端口）\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-sh line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[n(\"code\",[s._v(\"docker stop nginx_homepage\\ndocker \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"rm\")]),s._v(\" nginx_homepage\\n\")])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\")])])]),s._v(\" \"),n(\"li\",[n(\"p\",[s._v(\"基于nginx镜像，新建容器 (注意映射443端口)\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-sh line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[n(\"code\",[s._v(\"docker run --name nginx_homepage -itd -p \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"443\")]),s._v(\":443 -p \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"80\")]),s._v(\":80 \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/html:/usr/share/nginx/html \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/nginx.conf:/etc/nginx/nginx.conf \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/conf.d:/etc/nginx/conf.d \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/logs:/var/log/nginx \\nnginx\\n\")])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\")])])])]),s._v(\" \"),n(\"p\",[s._v(\"现在就可以https访问了！\")]),s._v(\" \"),n(\"h3\",{attrs:{id:\"blog升级\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#blog升级\"}},[s._v(\"#\")]),s._v(\" Blog升级\")]),s._v(\" \"),n(\"p\",[s._v(\"但此时，跳转到博客的链接还是http的，需要进行同样的改造。\")]),s._v(\" \"),n(\"p\",[s._v(\"想想之前访问博客时，使用的是http://heyan.site:8001端口，此时，期望不改动其他部分，只是将http换成https。所以，步骤应该是\")]),s._v(\" \"),n(\"p\",[s._v(\"1，2，3步 应该是和上面homepage升级是一样的\")]),s._v(\" \"),n(\"p\",[s._v(\"第4步，删除 nginx_blog即可\")]),s._v(\" \"),n(\"ol\",{attrs:{start:\"5\"}},[n(\"li\",[n(\"p\",[s._v(\"创建容器时，需要改成如下 - 所以当访问https:heyan.site:8001其实访问的是容器443端口\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-sh line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[n(\"code\",[s._v(\"docker run --name nginx_blog -itd -p \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8001\")]),s._v(\":443 -p \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8002\")]),s._v(\":80 \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/html:/usr/share/nginx/html \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/nginx.conf:/etc/nginx/nginx.conf \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/conf.d:/etc/nginx/conf.d \\n-v \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),n(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"pwd\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"/logs:/var/log/nginx \\nnginx\\n\")])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\")])]),n(\"p\",[s._v(\"（当然，这里没用到8002端口。。）\")])])]),s._v(\" \"),n(\"h3\",{attrs:{id:\"测试\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#测试\"}},[s._v(\"#\")]),s._v(\" \"),n(\"strong\",[s._v(\"测试\")])]),s._v(\" \"),n(\"p\",[s._v(\"https://heyan.site/\")]),s._v(\" \"),n(\"p\",[s._v(\"https://heyan.site:8001/\")]),s._v(\" \"),n(\"comment\"),s._v(\" \"),n(\"comment\"),s._v(\" \"),n(\"comment\"),s._v(\" \"),n(\"comment\"),s._v(\" \"),n(\"comment\")],1)}),[],!1,null,null,null);a.default=e.exports}}]);","extractedComments":[]}